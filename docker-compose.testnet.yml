version: '3.3'

services:
  hornet:
    image: iotaledger/hornet@sha256:05d4d7c8f609b2ebcd81c2d3fdb912a3c0cc87b444a50a1b05c91b05c0060f10
    restart: "no"
    working_dir: /app
    expose:
      # Node API
      - "14265"
      # libp2p/gossip protocol
      - "15600"
    ports:
      - "127.0.0.1:14265:14265/tcp"
      - "0.0.0.0:15600:15600/tcp"
    volumes:
      - './hornet/config_testnet.json:/app/config.json:ro'
      - './hornet/peering_testnet.json:/app/peering.json'
      - './data:/data'
      - '/etc/ssl/certs:/etc/ssl/certs:ro'
      - '/etc/localtime:/etc/localtime:ro'

  rosetta:
    build: .
    command: --bind-addr 0.0.0.0:3030 --network $NETWORK --bech32-hrp $BECH32_HRP --tx-tag $TX_TAG --node-url http://hornet:14265 --mode $MODE
    restart: "no"
    environment:
      RUST_LOG: info
      NETWORK: 'testnet7'
      BECH32_HRP: 'atoi'
    expose:
      # Rosetta API
      - "3030"
    ports:
      - "0.0.0.0:3030:3030/tcp"
